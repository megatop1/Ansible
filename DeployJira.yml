#The playbook will do the following
#1. Download the latest version of java CHECK
#2. Download MariaDB CHECK
#3. Create MariaDB Database
#4. Create a jira database user with correct permissions 
#5. Create directory named software
#6. Download the jira bin file from atlassian website
#7. run command chmod 700 bin-file to give it permissions
#8. run through the jira executable: ./bin
#9. create firewall rules for jira like opening port 8080

---   #Every Ansible Playbook starts with 3 "-"
- name: Jira           #Name of the playbook
  hosts: all           #Affects all hosts
  gather_facts: true   #Get variable names and facts
  become: true         #Become root when running the commands 
  
  tasks: 
    - name: install java
      yum:
        name:
          - java
      state: latest
      
    - name: Make software directory #Creates directory ~/software
      file:      
        path: ~/software
        state: directory   
      
    - name: download jira from atlassian website   #Name of the task
      get_url:      #This functions means we need to download something from a URL 
        url: https://www.atlassian.com/software/jira/downloads/binary/atlassian-jira-software-8.7.1-x64.bin   #This performs the download
        dest: ~/software   #This is where our file is being downloaded too
        
    - name: chmod 700 jira-install-bin
      file: 
        path: ~/software/atlassian-jira-software-8.7.1-x64.bin
        owner: root
        group: root
        mode: 700
        
    - name: Run through installer
      command: sh ~/software/atlassian-jira-software-8.7.1-x64.bin
      
    -name: answer questions
     expect: 
        command: ~/software/atlassian-jira-software-8.7.1-x64.bin
        responses: 
          Question: This will install Jira Software 8.7.1 on your computer.
            - response: c
          
        
    #- name: extract jira packages
     # unarchive: 
      #  src: ~/software/atlassian-jira-software-8.7.1-x64.bin
       # remote_src: yes
        #dest: ~/software #LAST THING I EDITED
    
   # - name: start jira services    #This task will ensure that even though we log out from the server, the service continously runs in the background
    #  shell: /opt/atlassian/jira/bin/startup.sh #This is the shell command being ran 
    
